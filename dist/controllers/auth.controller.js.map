{"version":3,"sources":["../../src/controllers/auth.controller.ts"],"sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport { Container } from 'typedi';\nimport { RequestWithUser } from '@interfaces/auth.interface';\nimport { User } from '@interfaces/users.interface';\nimport { AuthService } from '@services/auth.service';\n\nexport class AuthController {\n  public auth = Container.get(AuthService);\n\n  public signUp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: User = req.body;\n      console.log(userData)\n      const signUpUserData: User = await this.auth.signup(userData);\n\n      res.status(201).json({ data: signUpUserData, message: 'signup' });\n    } catch (error) {\n      console.log(error);\n      next(error);\n    }\n  };\n\n  public logIn = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: User = req.body;\n      const { cookie, findUser } = await this.auth.login(userData);\n      res.setHeader('Set-Cookie', [cookie]);\n      res.status(200).json({ data: findUser, message: 'login' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public logOut = async (req: RequestWithUser, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: User = req.user;\n      const logOutUserData: User = await this.auth.logout(userData);\n\n      res.setHeader('Set-Cookie', ['Authorization=; Max-age=0']);\n      res.status(200).json({ data: logOutUserData, message: 'logout' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public sendOTP = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const { email } = req.body;\n      const sendOTP = await this.auth.sendOTP(email);\n      if(sendOTP instanceof Error) throw new Error('Unable to send OTP');\n      res.status(200).json({ data: sendOTP.email, message: 'OTP sent' });\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  public verifyOtp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const { email, otp } = req.body;\n      const verifyOtp = await this.auth.verifyOTP(email, otp);\n      res.status(200).json({ verified: verifyOtp, message: 'OTP verified' });\n    } catch (error) {\n      next(error);\n    }\n  }\n}\n"],"names":["AuthController","auth","Container","get","AuthService","signUp","req","res","next","userData","body","console","log","signUpUserData","signup","status","json","data","message","error","logIn","cookie","findUser","login","setHeader","logOut","user","logOutUserData","logout","sendOTP","email","Error","verifyOtp","otp","verifyOTP","verified"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAMaA;;;eAAAA;;;wBALa;6BAGE;;;;;;;;;;;;;;AAErB,IAAA,AAAMA,iBAAN,MAAMA;;QACX,uBAAOC,QAAOC,iBAAS,CAACC,GAAG,CAACC,wBAAW;QAEvC,uBAAOC,UAAS,OAAOC,KAAcC,KAAeC;YAClD,IAAI;gBACF,MAAMC,WAAiBH,IAAII,IAAI;gBAC/BC,QAAQC,GAAG,CAACH;gBACZ,MAAMI,iBAAuB,MAAM,IAAI,CAACZ,IAAI,CAACa,MAAM,CAACL;gBAEpDF,IAAIQ,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,MAAMJ;oBAAgBK,SAAS;gBAAS;YACjE,EAAE,OAAOC,OAAO;gBACdR,QAAQC,GAAG,CAACO;gBACZX,KAAKW;YACP;QACF;QAEA,uBAAOC,SAAQ,OAAOd,KAAcC,KAAeC;YACjD,IAAI;gBACF,MAAMC,WAAiBH,IAAII,IAAI;gBAC/B,MAAM,EAAEW,MAAM,EAAEC,QAAQ,EAAE,GAAG,MAAM,IAAI,CAACrB,IAAI,CAACsB,KAAK,CAACd;gBACnDF,IAAIiB,SAAS,CAAC,cAAc;oBAACH;iBAAO;gBACpCd,IAAIQ,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,MAAMK;oBAAUJ,SAAS;gBAAQ;YAC1D,EAAE,OAAOC,OAAO;gBACdX,KAAKW;YACP;QACF;QAEA,uBAAOM,UAAS,OAAOnB,KAAsBC,KAAeC;YAC1D,IAAI;gBACF,MAAMC,WAAiBH,IAAIoB,IAAI;gBAC/B,MAAMC,iBAAuB,MAAM,IAAI,CAAC1B,IAAI,CAAC2B,MAAM,CAACnB;gBAEpDF,IAAIiB,SAAS,CAAC,cAAc;oBAAC;iBAA4B;gBACzDjB,IAAIQ,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,MAAMU;oBAAgBT,SAAS;gBAAS;YACjE,EAAE,OAAOC,OAAO;gBACdX,KAAKW;YACP;QACF;QAEA,uBAAOU,WAAU,OAAOvB,KAAcC,KAAeC;YACnD,IAAI;gBACF,MAAM,EAAEsB,KAAK,EAAE,GAAGxB,IAAII,IAAI;gBAC1B,MAAMmB,UAAU,MAAM,IAAI,CAAC5B,IAAI,CAAC4B,OAAO,CAACC;gBACxC,IAAGD,mBAAmBE,OAAO,MAAM,IAAIA,MAAM;gBAC7CxB,IAAIQ,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,MAAMY,QAAQC,KAAK;oBAAEZ,SAAS;gBAAW;YAClE,EAAE,OAAOC,OAAO;gBACdX,KAAKW;YACP;QACF;QAEA,uBAAOa,aAAY,OAAO1B,KAAcC,KAAeC;YACrD,IAAI;gBACF,MAAM,EAAEsB,KAAK,EAAEG,GAAG,EAAE,GAAG3B,IAAII,IAAI;gBAC/B,MAAMsB,YAAY,MAAM,IAAI,CAAC/B,IAAI,CAACiC,SAAS,CAACJ,OAAOG;gBACnD1B,IAAIQ,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEmB,UAAUH;oBAAWd,SAAS;gBAAe;YACtE,EAAE,OAAOC,OAAO;gBACdX,KAAKW;YACP;QACF;;AACF"}